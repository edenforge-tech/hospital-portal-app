(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{7583:function(e,t,s){Promise.resolve().then(s.bind(s,3999))},3999:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(5650),n=s(2317),o=s(9856),r=s(9216),l=s(3966),i=s(6470);function c(){let e=(0,o.useRouter)(),t=(0,l.t)(e=>e.setAuth),[s,c]=(0,n.useState)("admin@hospital.com"),[d,u]=(0,n.useState)("Admin@123456"),[g,m]=(0,n.useState)(""),[p,h]=(0,n.useState)([]),[f,b]=(0,n.useState)(""),[y,v]=(0,n.useState)(!1),[x,w]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=async()=>{try{let e;let t="http://localhost:5073/api";console.log("Fetching tenants from:",t);try{e=await i.Z.get("".concat(t,"/tenants/debug/codes/db"),{timeout:3e3}),console.log("Database tenants response:",e.data)}catch(s){console.log("Database tenants not available, using mock data"),e=await i.Z.get("".concat(t,"/tenants/debug/codes"),{timeout:3e3}),console.log("Mock tenants response:",e.data)}let s=[];if(e.data&&Array.isArray(e.data.tenants)?s=e.data.tenants:e.data&&Array.isArray(e.data)&&(s=e.data),console.log("Parsed tenants list:",s),s.length>0)h(s),m(s[0].id),console.log("Set tenants successfully:",s.length);else throw Error("No tenants found in response")}catch(t){console.error("Error fetching tenants:",t);let e=[{id:"11111111-1111-1111-1111-111111111111",name:"Apollo Hospitals - Main",tenantCode:"APOLLO-MAIN"},{id:"22222222-2222-2222-2222-222222222222",name:"Fortis Healthcare",tenantCode:"FORTIS-01"},{id:"33333333-3333-3333-3333-333333333333",name:"Max Healthcare",tenantCode:"MAX-HC"},{id:"44444444-4444-4444-4444-444444444444",name:"Narayana Health",tenantCode:"NARAYANA"},{id:"55555555-5555-5555-5555-555555555555",name:"Sankara Eye Hospital",tenantCode:"SANKARA"}];h(e),m(e[0].id),console.log("Using fallback tenants:",e.length)}finally{w(!1)}};e()},[]);let A=async()=>{b(""),v(!0);try{let e=(0,r.ac)(),t=g||"11111111-1111-1111-1111-111111111111";await e.post("/auth/debug/create-admin?tenantId=".concat(t)),alert("Admin user created successfully! Email: admin@hospital.com, Password: Admin@123456"),c("admin@hospital.com"),u("Admin@123456"),m(t)}catch(o){var e,t,s,a;console.error("Create admin error:",o);let n=(null===(t=o.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||(null===(a=o.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||o.message||"Failed to create admin user. Check backend logs.";b(n)}finally{v(!1)}},S=async a=>{a.preventDefault(),b(""),v(!0);try{(0,r.qN)(),console.log("Attempting login with:",{email:s,password:d,tenantId:g});let a=await r.iJ.login(s,d,g);console.log("Login response:",a);let{data:n}=a;if(console.log("Login data:",n),!n.success){console.log("Login failed - no success flag"),b(n.message||"Login failed");return}console.log("Login successful, calling setAuth..."),t(n.accessToken,n.refreshToken,n.user,n.roles,n.permissions,g,n.mustChangePassword),console.log("Auth state set, checking mustChangePassword:",n.mustChangePassword),n.mustChangePassword?(console.log("Redirecting to change password"),e.push("/auth/change-password")):(console.log("Redirecting to dashboard"),e.push("/dashboard"))}catch(t){var n,o,l,i;console.error("Login error:",t);let e="An error occurred during login. ";(null===(o=t.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)?e+=t.response.data.message:(null===(i=t.response)||void 0===i?void 0:null===(l=i.data)||void 0===l?void 0:l.error)?e+=t.response.data.error:t.message&&(e+=t.message),e.includes("An error occurred during login")&&!e.includes("user")&&(e+=' (Database may be empty. Try clicking "Create Admin User" below.)'),b(e)}finally{v(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-indigo-600",children:"Eye Hospital"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Hospital Management System"})]}),(0,a.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[f&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:f}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant"}),x?(0,a.jsx)("div",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500",children:"Loading tenants..."}):p.length>0?(0,a.jsxs)("select",{value:g,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select your hospital"}),p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}):(0,a.jsx)("input",{type:"text",value:g,onChange:e=>m(e.target.value),placeholder:"Enter your hospital tenant ID",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,a.jsx)("input",{type:"email",value:s,onChange:e=>c(e.target.value),placeholder:"your@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),(0,a.jsx)("input",{type:"password",value:d,onChange:e=>u(e.target.value),placeholder:"••••••••",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),(0,a.jsx)("button",{type:"submit",disabled:y,className:"w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:y?"Logging in...":"Login"}),(0,a.jsx)("button",{type:"button",onClick:A,disabled:y,className:"w-full mt-2 bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:y?"Creating...":"Create Admin User (Dev Only)"})]}),(0,a.jsx)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,a.jsx)("strong",{children:"Demo Credentials:"}),(0,a.jsx)("br",{}),"Email: admin@hospital.com",(0,a.jsx)("br",{}),"Password: Use the one provided",(0,a.jsx)("br",{}),"Tenant: Select from dropdown above"]})})]})})}},9216:function(e,t,s){"use strict";let a;s.d(t,{Di:function(){return i},J2:function(){return m},WU:function(){return p},ac:function(){return l},g8:function(){return u},h0:function(){return g},h5:function(){return c},iJ:function(){return d},qN:function(){return r},sl:function(){return h}});var n=s(6470),o=s(3966);s(2189);let r=()=>((a=n.Z.create({baseURL:"http://localhost:5073/api",headers:{"Content-Type":"application/json"}})).interceptors.request.use(e=>{let{tenantId:t,token:s}=o.t.getState();return t&&(e.headers["X-Tenant-ID"]=t),s&&(e.headers.Authorization="Bearer ".concat(s)),e}),a.interceptors.response.use(e=>e,e=>{var t,s;return(null===(t=e.response)||void 0===t?void 0:t.status)===401?(o.t.getState().logout(),window.location.href="/auth/login"):(null===(s=e.response)||void 0===s?void 0:s.status)===403&&(window.location.href="/dashboard/unauthorized"),Promise.reject(e)}),a),l=()=>a||r(),i={getAll:()=>l().get("/patients"),getById:e=>l().get("/patients/".concat(e)),create:e=>l().post("/patients",e),update:(e,t)=>l().put("/patients/".concat(e),t),delete:e=>l().delete("/patients/".concat(e))},c={getAll:()=>l().get("/examinations"),getById:e=>l().get("/examinations/".concat(e)),getByPatient:e=>l().get("/examinations/patient/".concat(e)),create:e=>l().post("/examinations",e),update:(e,t)=>l().put("/examinations/".concat(e),t),delete:e=>l().delete("/examinations/".concat(e))},d={login:(e,t,s)=>l().post("/auth/login",{email:e,password:t,tenantId:s}),changePassword:(e,t)=>l().post("/auth/change-password",{currentPassword:e,newPassword:t})},u={getAll:()=>l().get("/users"),getAllWithDetails:()=>l().get("/users/with-details"),getById:e=>l().get("/users/".concat(e)),create:e=>l().post("/users",e),update:(e,t)=>l().put("/users/".concat(e),t),deactivate:e=>l().post("/users/".concat(e,"/deactivate"))},g={getAll:()=>l().get("/roles"),getAllWithUserCount:()=>l().get("/roles/with-user-count"),getById:e=>l().get("/roles/".concat(e)),create:e=>l().post("/roles",e),update:(e,t)=>l().put("/roles/".concat(e),t),delete:e=>l().delete("/roles/".concat(e)),assignRole:(e,t,s)=>l().post("/users/".concat(e,"/roles"),{roleId:t,branchId:s}),getRolePermissions:e=>l().get("/roles/".concat(e,"/permissions")),assignPermissions:(e,t)=>l().post("/roles/".concat(e,"/permissions"),{permissionIds:t}),removePermissions:(e,t)=>l().delete("/roles/".concat(e,"/permissions"),{data:{permissionIds:t}}),cloneRole:(e,t,s)=>l().post("/roles/".concat(e,"/clone"),{name:t,description:s})},m={getAll:()=>l().get("/permissions"),getAllGrouped:()=>l().get("/permissions/grouped"),getById:e=>l().get("/permissions/".concat(e)),create:e=>l().post("/permissions",e),update:(e,t)=>l().put("/permissions/".concat(e),t),delete:e=>l().delete("/permissions/".concat(e)),getByCategory:e=>l().get("/permissions/category/".concat(e)),bulkAssign:(e,t)=>l().post("/permissions/bulk-assign",{roleId:e,permissionIds:t}),bulkRemove:(e,t)=>l().delete("/permissions/bulk-remove",{data:{roleId:e,permissionIds:t}}),getMatrix:()=>l().get("/permissions/matrix"),getStatistics:()=>l().get("/permissions/statistics")},p={getAll:()=>l().get("/departments"),getAllWithStaffCount:()=>l().get("/departments/with-staff-count"),getById:e=>l().get("/departments/".concat(e))},h={getAll:()=>l().get("/branches")}},2189:function(e,t,s){"use strict";s.d(t,{f:function(){return n}});var a=s(9216);let n={assign:async function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,a.ac)().post("/users/".concat(e,"/department-access"),{departmentId:t,accessLevel:s,isPrimary:n})},revoke:async(e,t)=>(0,a.ac)().delete("/users/".concat(e,"/department-access/").concat(t)),getUserDepartments:async e=>{let t=await (0,a.ac)().get("/users/".concat(e,"/department-access"));return t.data},getDepartmentUsers:async e=>(0,a.ac)().get("/departments/".concat(e,"/user-access")),updateAccessLevel:async(e,t,s)=>(0,a.ac)().put("/users/".concat(e,"/department-access/").concat(t),{accessLevel:s}),setPrimary:async(e,t)=>(0,a.ac)().put("/users/".concat(e,"/department-access/").concat(t),{isPrimary:!0}),bulkAssign:async e=>(0,a.ac)().post("/user-department-access/bulk-assign",{assignments:e}),getAccessMatrix:async e=>{let t=e?{departmentId:e}:{};return(0,a.ac)().get("/user-department-access/matrix",{params:t})}}},3966:function(e,t,s){"use strict";s.d(t,{R:function(){return o},t:function(){return n}});var a=s(9147);let n=(0,a.Ue)((e,t)=>({user:null,token:null,refreshToken:null,tenantId:null,roles:[],permissions:[],isLoading:!1,mustChangePassword:!1,setAuth:(t,s,a,n,o,r,l)=>{e({token:t,refreshToken:s,user:a,roles:n,permissions:o,tenantId:r,mustChangePassword:l}),localStorage.setItem("auth_token",t),localStorage.setItem("refresh_token",s),localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("roles",JSON.stringify(n)),localStorage.setItem("permissions",JSON.stringify(o)),localStorage.setItem("tenant_id",r)},logout:()=>{e({user:null,token:null,refreshToken:null,tenantId:null,roles:[],permissions:[],mustChangePassword:!1}),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),localStorage.removeItem("roles"),localStorage.removeItem("permissions"),localStorage.removeItem("tenant_id")},clearMustChangePassword:()=>e({mustChangePassword:!1}),hasPermission:e=>{let{permissions:s}=t();return!!(s&&Array.isArray(s))&&(!!s.includes("*")||s.includes(e))},hasRole:e=>{let{roles:s}=t();return!!(s&&Array.isArray(s))&&s.includes(e)}}));function o(){try{let e=localStorage.getItem("auth_token"),t=localStorage.getItem("refresh_token"),s=localStorage.getItem("user"),a=localStorage.getItem("roles"),o=localStorage.getItem("permissions"),r=localStorage.getItem("tenant_id");if(e&&s){let l=JSON.parse(s),i=a?JSON.parse(a):[],c=o?JSON.parse(o):[];n.getState().setAuth(e,t||null,l,i,c,r||null,n.getState().mustChangePassword)}}catch(e){console.warn("Failed to hydrate auth from storage",e)}}},9856:function(e,t,s){e.exports=s(39)}},function(e){e.O(0,[675,510,662,744],function(){return e(e.s=7583)}),_N_E=e.O()}]);