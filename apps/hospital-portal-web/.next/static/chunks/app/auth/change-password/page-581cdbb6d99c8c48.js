(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[263],{9517:function(e,t,s){Promise.resolve().then(s.bind(s,3738))},3738:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var r=s(5650),a=s(2317),n=s(9856),o=s(9216),c=s(3966);function l(){let e=(0,n.useRouter)(),{mustChangePassword:t,clearMustChangePassword:s,user:l}=(0,c.t)(),[i,u]=(0,a.useState)(""),[d,g]=(0,a.useState)(""),[m,p]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),[b,y]=(0,a.useState)(""),[x,w]=(0,a.useState)(!1),v=e=>{let t=/[A-Z]/.test(e),s=/[a-z]/.test(e),r=/\d/.test(e),a=/[!@#$%^&*]/.test(e),n=e.length>=12;return t&&s&&r&&a&&n},S=async t=>{t.preventDefault(),f(""),y(""),w(!0);try{if(!i||!d||!m){f("All fields are required");return}if(d!==m){f("Passwords do not match");return}if(!v(d)){f("Password must be at least 12 characters with uppercase, lowercase, numbers, and special characters");return}if(i===d){f("New password must be different from current password");return}await o.iJ.changePassword(i,d),y("Password changed successfully!"),s(),setTimeout(()=>{e.push("/dashboard")},2e3)}catch(e){var r,a;f((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"Failed to change password")}finally{w(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-amber-50 to-orange-100",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl p-8 w-full max-w-md",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-amber-600",children:"Change Password"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:t?"You must change your password before accessing the system":"Update your password"}),l&&(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["User: ",l.email]})]}),(0,r.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[h&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:h}),b&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:b}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),(0,r.jsx)("input",{type:"password",value:i,onChange:e=>u(e.target.value),placeholder:"••••••••",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,r.jsx)("input",{type:"password",value:d,onChange:e=>g(e.target.value),placeholder:"••••••••",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Must be 12+ characters with uppercase, lowercase, numbers, and special characters"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),(0,r.jsx)("input",{type:"password",value:m,onChange:e=>p(e.target.value),placeholder:"••••••••",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),(0,r.jsx)("button",{type:"submit",disabled:x,className:"w-full bg-amber-600 text-white py-2 rounded-lg font-semibold hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:x?"Changing Password...":"Change Password"})]})]})})}},9216:function(e,t,s){"use strict";let r;s.d(t,{Di:function(){return l},J2:function(){return m},WU:function(){return p},ac:function(){return c},g8:function(){return d},h0:function(){return g},h5:function(){return i},iJ:function(){return u},qN:function(){return o},sl:function(){return h}});var a=s(6470),n=s(3966);s(2189);let o=()=>((r=a.Z.create({baseURL:"http://localhost:5073/api",headers:{"Content-Type":"application/json"}})).interceptors.request.use(e=>{let{tenantId:t,token:s}=n.t.getState();return t&&(e.headers["X-Tenant-ID"]=t),s&&(e.headers.Authorization="Bearer ".concat(s)),e}),r.interceptors.response.use(e=>e,e=>{var t,s;return(null===(t=e.response)||void 0===t?void 0:t.status)===401?(n.t.getState().logout(),window.location.href="/auth/login"):(null===(s=e.response)||void 0===s?void 0:s.status)===403&&(window.location.href="/dashboard/unauthorized"),Promise.reject(e)}),r),c=()=>r||o(),l={getAll:()=>c().get("/patients"),getById:e=>c().get("/patients/".concat(e)),create:e=>c().post("/patients",e),update:(e,t)=>c().put("/patients/".concat(e),t),delete:e=>c().delete("/patients/".concat(e))},i={getAll:()=>c().get("/examinations"),getById:e=>c().get("/examinations/".concat(e)),getByPatient:e=>c().get("/examinations/patient/".concat(e)),create:e=>c().post("/examinations",e),update:(e,t)=>c().put("/examinations/".concat(e),t),delete:e=>c().delete("/examinations/".concat(e))},u={login:(e,t,s)=>c().post("/auth/login",{email:e,password:t,tenantId:s}),changePassword:(e,t)=>c().post("/auth/change-password",{currentPassword:e,newPassword:t})},d={getAll:()=>c().get("/users"),getAllWithDetails:()=>c().get("/users/with-details"),getById:e=>c().get("/users/".concat(e)),create:e=>c().post("/users",e),update:(e,t)=>c().put("/users/".concat(e),t),deactivate:e=>c().post("/users/".concat(e,"/deactivate"))},g={getAll:()=>c().get("/roles"),getAllWithUserCount:()=>c().get("/roles/with-user-count"),getById:e=>c().get("/roles/".concat(e)),create:e=>c().post("/roles",e),update:(e,t)=>c().put("/roles/".concat(e),t),delete:e=>c().delete("/roles/".concat(e)),assignRole:(e,t,s)=>c().post("/users/".concat(e,"/roles"),{roleId:t,branchId:s}),getRolePermissions:e=>c().get("/roles/".concat(e,"/permissions")),assignPermissions:(e,t)=>c().post("/roles/".concat(e,"/permissions"),{permissionIds:t}),removePermissions:(e,t)=>c().delete("/roles/".concat(e,"/permissions"),{data:{permissionIds:t}}),cloneRole:(e,t,s)=>c().post("/roles/".concat(e,"/clone"),{name:t,description:s})},m={getAll:()=>c().get("/permissions"),getAllGrouped:()=>c().get("/permissions/grouped"),getById:e=>c().get("/permissions/".concat(e)),create:e=>c().post("/permissions",e),update:(e,t)=>c().put("/permissions/".concat(e),t),delete:e=>c().delete("/permissions/".concat(e)),getByCategory:e=>c().get("/permissions/category/".concat(e)),bulkAssign:(e,t)=>c().post("/permissions/bulk-assign",{roleId:e,permissionIds:t}),bulkRemove:(e,t)=>c().delete("/permissions/bulk-remove",{data:{roleId:e,permissionIds:t}}),getMatrix:()=>c().get("/permissions/matrix"),getStatistics:()=>c().get("/permissions/statistics")},p={getAll:()=>c().get("/departments"),getAllWithStaffCount:()=>c().get("/departments/with-staff-count"),getById:e=>c().get("/departments/".concat(e))},h={getAll:()=>c().get("/branches")}},2189:function(e,t,s){"use strict";s.d(t,{f:function(){return a}});var r=s(9216);let a={assign:async function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,r.ac)().post("/users/".concat(e,"/department-access"),{departmentId:t,accessLevel:s,isPrimary:a})},revoke:async(e,t)=>(0,r.ac)().delete("/users/".concat(e,"/department-access/").concat(t)),getUserDepartments:async e=>{let t=await (0,r.ac)().get("/users/".concat(e,"/department-access"));return t.data},getDepartmentUsers:async e=>(0,r.ac)().get("/departments/".concat(e,"/user-access")),updateAccessLevel:async(e,t,s)=>(0,r.ac)().put("/users/".concat(e,"/department-access/").concat(t),{accessLevel:s}),setPrimary:async(e,t)=>(0,r.ac)().put("/users/".concat(e,"/department-access/").concat(t),{isPrimary:!0}),bulkAssign:async e=>(0,r.ac)().post("/user-department-access/bulk-assign",{assignments:e}),getAccessMatrix:async e=>{let t=e?{departmentId:e}:{};return(0,r.ac)().get("/user-department-access/matrix",{params:t})}}},3966:function(e,t,s){"use strict";s.d(t,{R:function(){return n},t:function(){return a}});var r=s(9147);let a=(0,r.Ue)((e,t)=>({user:null,token:null,refreshToken:null,tenantId:null,roles:[],permissions:[],isLoading:!1,mustChangePassword:!1,setAuth:(t,s,r,a,n,o,c)=>{e({token:t,refreshToken:s,user:r,roles:a,permissions:n,tenantId:o,mustChangePassword:c}),localStorage.setItem("auth_token",t),localStorage.setItem("refresh_token",s),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("roles",JSON.stringify(a)),localStorage.setItem("permissions",JSON.stringify(n)),localStorage.setItem("tenant_id",o)},logout:()=>{e({user:null,token:null,refreshToken:null,tenantId:null,roles:[],permissions:[],mustChangePassword:!1}),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),localStorage.removeItem("roles"),localStorage.removeItem("permissions"),localStorage.removeItem("tenant_id")},clearMustChangePassword:()=>e({mustChangePassword:!1}),hasPermission:e=>{let{permissions:s}=t();return!!(s&&Array.isArray(s))&&(!!s.includes("*")||s.includes(e))},hasRole:e=>{let{roles:s}=t();return!!(s&&Array.isArray(s))&&s.includes(e)}}));function n(){try{let e=localStorage.getItem("auth_token"),t=localStorage.getItem("refresh_token"),s=localStorage.getItem("user"),r=localStorage.getItem("roles"),n=localStorage.getItem("permissions"),o=localStorage.getItem("tenant_id");if(e&&s){let c=JSON.parse(s),l=r?JSON.parse(r):[],i=n?JSON.parse(n):[];a.getState().setAuth(e,t||null,c,l,i,o||null,a.getState().mustChangePassword)}}catch(e){console.warn("Failed to hydrate auth from storage",e)}}},9856:function(e,t,s){e.exports=s(39)}},function(e){e.O(0,[675,510,662,744],function(){return e(e.s=9517)}),_N_E=e.O()}]);