(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[336],{8401:function(e,t,s){"use strict";s.d(t,{i:function(){return i}});var r=s(5650),a=s(5830),n=s(9856),o=s(2317);function i(e){let{children:t,requiredPermission:s,requiredRole:i,fallbackPath:l="/dashboard/unauthorized"}=e,c=(0,n.useRouter)(),{token:u,hasPermission:g,hasRole:m}=(0,a.c_)(),[d,h]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{setTimeout(()=>h(!0),50)},[]),(0,o.useEffect)(()=>{if(d){if(!u){c.push("/auth/login");return}if(s&&!g(s)||i&&!m(i)){c.push(l);return}}},[d,u,s,i,c,g,m]),d&&u)?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})}},9216:function(e,t,s){"use strict";let r;s.d(t,{Di:function(){return l},J2:function(){return d},WU:function(){return h},ac:function(){return i},g8:function(){return g},h0:function(){return m},h5:function(){return c},iJ:function(){return u},qN:function(){return o},sl:function(){return p}});var a=s(6470),n=s(3966);s(2189);let o=()=>((r=a.Z.create({baseURL:"http://localhost:5073/api",headers:{"Content-Type":"application/json"}})).interceptors.request.use(e=>{let{tenantId:t,token:s}=n.t.getState();return t&&(e.headers["X-Tenant-ID"]=t),s&&(e.headers.Authorization="Bearer ".concat(s)),e}),r.interceptors.response.use(e=>e,e=>{var t,s;return(null===(t=e.response)||void 0===t?void 0:t.status)===401?(n.t.getState().logout(),window.location.href="/auth/login"):(null===(s=e.response)||void 0===s?void 0:s.status)===403&&(window.location.href="/dashboard/unauthorized"),Promise.reject(e)}),r),i=()=>r||o(),l={getAll:()=>i().get("/patients"),getById:e=>i().get("/patients/".concat(e)),create:e=>i().post("/patients",e),update:(e,t)=>i().put("/patients/".concat(e),t),delete:e=>i().delete("/patients/".concat(e))},c={getAll:()=>i().get("/examinations"),getById:e=>i().get("/examinations/".concat(e)),getByPatient:e=>i().get("/examinations/patient/".concat(e)),create:e=>i().post("/examinations",e),update:(e,t)=>i().put("/examinations/".concat(e),t),delete:e=>i().delete("/examinations/".concat(e))},u={login:(e,t,s)=>i().post("/auth/login",{email:e,password:t,tenantId:s}),changePassword:(e,t)=>i().post("/auth/change-password",{currentPassword:e,newPassword:t})},g={getAll:()=>i().get("/users"),getAllWithDetails:()=>i().get("/users/with-details"),getById:e=>i().get("/users/".concat(e)),create:e=>i().post("/users",e),update:(e,t)=>i().put("/users/".concat(e),t),deactivate:e=>i().post("/users/".concat(e,"/deactivate"))},m={getAll:()=>i().get("/roles"),getAllWithUserCount:()=>i().get("/roles/with-user-count"),getById:e=>i().get("/roles/".concat(e)),create:e=>i().post("/roles",e),update:(e,t)=>i().put("/roles/".concat(e),t),delete:e=>i().delete("/roles/".concat(e)),assignRole:(e,t,s)=>i().post("/users/".concat(e,"/roles"),{roleId:t,branchId:s}),getRolePermissions:e=>i().get("/roles/".concat(e,"/permissions")),assignPermissions:(e,t)=>i().post("/roles/".concat(e,"/permissions"),{permissionIds:t}),removePermissions:(e,t)=>i().delete("/roles/".concat(e,"/permissions"),{data:{permissionIds:t}}),cloneRole:(e,t,s)=>i().post("/roles/".concat(e,"/clone"),{name:t,description:s})},d={getAll:()=>i().get("/permissions"),getAllGrouped:()=>i().get("/permissions/grouped"),getById:e=>i().get("/permissions/".concat(e)),create:e=>i().post("/permissions",e),update:(e,t)=>i().put("/permissions/".concat(e),t),delete:e=>i().delete("/permissions/".concat(e)),getByCategory:e=>i().get("/permissions/category/".concat(e)),bulkAssign:(e,t)=>i().post("/permissions/bulk-assign",{roleId:e,permissionIds:t}),bulkRemove:(e,t)=>i().delete("/permissions/bulk-remove",{data:{roleId:e,permissionIds:t}}),getMatrix:()=>i().get("/permissions/matrix"),getStatistics:()=>i().get("/permissions/statistics")},h={getAll:()=>i().get("/departments"),getAllWithStaffCount:()=>i().get("/departments/with-staff-count"),getById:e=>i().get("/departments/".concat(e))},p={getAll:()=>i().get("/branches")}},2189:function(e,t,s){"use strict";s.d(t,{f:function(){return a}});var r=s(9216);let a={assign:async function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,r.ac)().post("/users/".concat(e,"/department-access"),{departmentId:t,accessLevel:s,isPrimary:a})},revoke:async(e,t)=>(0,r.ac)().delete("/users/".concat(e,"/department-access/").concat(t)),getUserDepartments:async e=>{let t=await (0,r.ac)().get("/users/".concat(e,"/department-access"));return t.data},getDepartmentUsers:async e=>(0,r.ac)().get("/departments/".concat(e,"/user-access")),updateAccessLevel:async(e,t,s)=>(0,r.ac)().put("/users/".concat(e,"/department-access/").concat(t),{accessLevel:s}),setPrimary:async(e,t)=>(0,r.ac)().put("/users/".concat(e,"/department-access/").concat(t),{isPrimary:!0}),bulkAssign:async e=>(0,r.ac)().post("/user-department-access/bulk-assign",{assignments:e}),getAccessMatrix:async e=>{let t=e?{departmentId:e}:{};return(0,r.ac)().get("/user-department-access/matrix",{params:t})}}},3966:function(e,t,s){"use strict";s.d(t,{R:function(){return n},t:function(){return a}});var r=s(9147);let a=(0,r.Ue)((e,t)=>({user:null,token:null,refreshToken:null,tenantId:null,roles:[],permissions:[],isLoading:!1,mustChangePassword:!1,setAuth:(t,s,r,a,n,o,i)=>{e({token:t,refreshToken:s,user:r,roles:a,permissions:n,tenantId:o,mustChangePassword:i}),localStorage.setItem("auth_token",t),localStorage.setItem("refresh_token",s),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("roles",JSON.stringify(a)),localStorage.setItem("permissions",JSON.stringify(n)),localStorage.setItem("tenant_id",o)},logout:()=>{e({user:null,token:null,refreshToken:null,tenantId:null,roles:[],permissions:[],mustChangePassword:!1}),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),localStorage.removeItem("roles"),localStorage.removeItem("permissions"),localStorage.removeItem("tenant_id")},clearMustChangePassword:()=>e({mustChangePassword:!1}),hasPermission:e=>{let{permissions:s}=t();return!!(s&&Array.isArray(s))&&(!!s.includes("*")||s.includes(e))},hasRole:e=>{let{roles:s}=t();return!!(s&&Array.isArray(s))&&s.includes(e)}}));function n(){try{let e=localStorage.getItem("auth_token"),t=localStorage.getItem("refresh_token"),s=localStorage.getItem("user"),r=localStorage.getItem("roles"),n=localStorage.getItem("permissions"),o=localStorage.getItem("tenant_id");if(e&&s){let i=JSON.parse(s),l=r?JSON.parse(r):[],c=n?JSON.parse(n):[];a.getState().setAuth(e,t||null,i,l,c,o||null,a.getState().mustChangePassword)}}catch(e){console.warn("Failed to hydrate auth from storage",e)}}},5830:function(e,t,s){"use strict";s.d(t,{c_:function(){return n}});var r=s(3966);let a=new class{get(e){let t=this.cache.get(e);return t?Date.now()>t.timestamp+t.ttl?(this.cache.delete(e),this.saveToStorage(),null):t:null}set(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={permissions:[...t],roles:[...s],timestamp:Date.now(),ttl:r.ttl||this.defaultTTL};this.cache.set(e,a),this.saveToStorage()}invalidate(e){this.cache.delete(e),this.saveToStorage()}clear(){this.cache.clear(),this.saveToStorage()}hasPermission(e,t){let s=this.get(e);return s?!!s.permissions.includes("*")||s.permissions.includes(t):null}hasRole(e,t){let s=this.get(e);return s?s.roles.includes(t):null}getPermissions(e){let t=this.get(e);return t?[...t.permissions]:null}getRoles(e){let t=this.get(e);return t?[...t.roles]:null}saveToStorage(){try{let e=Object.fromEntries(this.cache);localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.warn("Failed to save permission cache to storage:",e)}}loadFromStorage(){try{let e=localStorage.getItem(this.storageKey);if(e){let t=JSON.parse(e);this.cache=new Map(Object.entries(t))}}catch(e){console.warn("Failed to load permission cache from storage:",e),this.cache.clear()}}startCleanupInterval(){setInterval(()=>{let e=Date.now(),t=!1;for(let[s,r]of this.cache.entries())e>r.timestamp+r.ttl&&(this.cache.delete(s),t=!0);t&&this.saveToStorage()},6e4)}constructor(){this.cache=new Map,this.defaultTTL=3e5,this.storageKey="permission_cache",this.loadFromStorage(),this.startCleanupInterval()}};function n(){let e=(0,r.t)();return{...e,hasPermission:t=>{let s=e.user;if(!s)return!1;let r=a.hasPermission(s.id,t);return null!==r?r:e.hasPermission(t)},hasRole:t=>{let s=e.user;if(!s)return!1;let r=a.hasRole(s.id,t);return null!==r?r:e.hasRole(t)},getPermissions:()=>{let t=e.user;if(!t)return[];let s=a.getPermissions(t.id);return null!==s?s:e.permissions||[]},getRoles:()=>{let t=e.user;if(!t)return[];let s=a.getRoles(t.id);return null!==s?s:e.roles||[]},setAuth:(t,s,r,n,o,i,l)=>{e.setAuth(t,s,r,n,o,i,l),a.set(r.id,o,n)},logout:()=>{let t=e.user;t&&a.invalidate(t.id),e.logout()}}}},9856:function(e,t,s){e.exports=s(39)}}]);