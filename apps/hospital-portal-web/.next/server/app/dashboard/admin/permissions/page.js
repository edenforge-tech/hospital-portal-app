(()=>{var e={};e.id=2819,e.ids=[2819],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},612:e=>{"use strict";e.exports=require("node:os")},5830:e=>{"use strict";e.exports=require("node:process")},5997:e=>{"use strict";e.exports=require("node:tty")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},8521:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>x,pages:()=>m,routeModule:()=>u,tree:()=>c});var r=t(9173),i=t(8318),a=t(3526),l=t.n(a),o=t(8996),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);t.d(s,n);let d=r.AppPageRouteModule,c=["",{children:["dashboard",{children:["admin",{children:["permissions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,3767)),"C:\\Users\\Sam Aluri\\Downloads\\Hospital Portal\\apps\\hospital-portal-web\\src\\app\\dashboard\\admin\\permissions\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,6687)),"C:\\Users\\Sam Aluri\\Downloads\\Hospital Portal\\apps\\hospital-portal-web\\src\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,6840)),"C:\\Users\\Sam Aluri\\Downloads\\Hospital Portal\\apps\\hospital-portal-web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,1403,23)),"next/dist/client/components/not-found-error"]}],m=["C:\\Users\\Sam Aluri\\Downloads\\Hospital Portal\\apps\\hospital-portal-web\\src\\app\\dashboard\\admin\\permissions\\page.tsx"],x="/dashboard/admin/permissions/page",p={require:t,loadChunk:()=>Promise.resolve()},u=new d({definition:{kind:i.x.APP_PAGE,page:"/dashboard/admin/permissions/page",pathname:"/dashboard/admin/permissions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1980:(e,s,t)=>{Promise.resolve().then(t.bind(t,8042))},8042:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var r=t(3393),i=t(7838),a=t(7928),l=t(8661),o=t(722);function n(){let{user:e}=(0,i.c_)();(0,a.useRouter)();let[s,t]=(0,l.useState)(null),[n,d]=(0,l.useState)(!0),[c,m]=(0,l.useState)(!1),[x,p]=(0,l.useState)(""),[u,h]=(0,l.useState)("all"),[g,b]=(0,l.useState)(""),[f,y]=(0,l.useState)(""),[j,v]=(0,l.useState)(new Set),[w,N]=(0,l.useState)(new Set);(0,l.useEffect)(()=>{e&&S()},[e]);let S=async()=>{try{d(!0);let e=await o.J2.getAll(),s=e.data?.permissions||[],r=await o.h0.getAllWithUserCount(),i=r.data||[],a=i.map(e=>o.h0.getRolePermissions(e.id).catch(()=>({data:[]}))),l=await Promise.all(a),n={};i.forEach((e,s)=>{n[e.id]=l[s].data?.map(e=>e.id)||[]}),t({permissions:s,roles:i,assignments:n})}catch(e){console.error("Error loading permission matrix:",e),b("Failed to load permission matrix")}finally{d(!1)}},P=(e,r)=>{if(!s)return;let i={...s},a=i.assignments[e]||[];a.includes(r)?i.assignments[e]=a.filter(e=>e!==r):i.assignments[e]=[...a,r],t(i)},C=async()=>{if(s&&0!==j.size&&0!==w.size){m(!0);try{let e=[];for(let t of w){let r=s.assignments[t]||[],i=Array.from(j).filter(e=>!r.includes(e));i.length>0&&e.push({roleId:t,permissionIds:[...r,...i]})}for(let s of e)await o.h0.assignPermissions(s.roleId,s.permissionIds);y(`Bulk assigned ${j.size} permissions to ${w.size} roles`),v(new Set),N(new Set),S(),setTimeout(()=>y(""),3e3)}catch(e){b(e.response?.data?.message||"Failed to assign permissions")}finally{m(!1)}}},k=async()=>{if(s&&0!==j.size&&0!==w.size){m(!0);try{let e=[];for(let t of w){let r=s.assignments[t]||[],i=r.filter(e=>!j.has(e));e.push({roleId:t,permissionIds:i})}for(let s of e)await o.h0.assignPermissions(s.roleId,s.permissionIds);y(`Bulk removed ${j.size} permissions from ${w.size} roles`),v(new Set),N(new Set),S(),setTimeout(()=>y(""),3e3)}catch(e){b(e.response?.data?.message||"Failed to remove permissions")}finally{m(!1)}}},q=e=>{v(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},A=e=>{N(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},_=s?.permissions.filter(e=>("all"===u||e.module===u)&&(e.name.toLowerCase().includes(x.toLowerCase())||e.description?.toLowerCase().includes(x.toLowerCase())||e.code.toLowerCase().includes(x.toLowerCase())))||[],z=[...new Set(s?.permissions.map(e=>e.module)||[])];return n||!e?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading permissions matrix..."})]})}):r.jsx("div",{className:"p-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Permissions Management"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Manage permissions and bulk assignments across roles"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:C,disabled:c||0===j.size||0===w.size,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Assigning...":`Assign to ${w.size} Roles`}),r.jsx("button",{onClick:k,disabled:c||0===j.size||0===w.size,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Removing...":`Remove from ${w.size} Roles`})]})]}),(0,r.jsxs)("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Bulk Operations"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-blue-800 mb-2",children:["Permissions (",j.size," selected)"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>{v(new Set(_.map(e=>e.id)))},className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Select All"}),r.jsx("button",{onClick:()=>{v(new Set)},className:"px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700",children:"Clear All"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-blue-800 mb-2",children:["Roles (",w.size," selected)"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>{N(new Set(s?.roles.map(e=>e.id)||[]))},className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Select All"}),r.jsx("button",{onClick:()=>{N(new Set)},className:"px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700",children:"Clear All"})]})]})]})]}),f&&r.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg",children:f}),g&&(0,r.jsxs)("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg",children:[g,r.jsx("button",{onClick:()=>b(""),className:"float-right font-bold",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"mb-6 flex gap-4",children:[r.jsx("div",{className:"flex-1",children:r.jsx("input",{type:"text",placeholder:"Search permissions...",value:x,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})}),r.jsx("div",{children:(0,r.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[r.jsx("option",{value:"all",children:"All Modules"}),z.map(e=>r.jsx("option",{value:e,children:e},e))]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-50",children:"Permission"}),s?.roles.map(e=>r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[120px]",children:r.jsxs("div",{className:"flex flex-col items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:w.has(e.id),onChange:()=>A(e.id),className:"h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",title:"Select role for bulk operation"}),r.jsxs("div",{className:"text-center",children:[e.name,r.jsx("br",{}),r.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.userCount||0," users)"]})]})]})},e.id))]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 sticky left-0 bg-white border-r border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"checkbox",checked:j.has(e.id),onChange:()=>q(e.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",title:"Select for bulk operation"}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.name}),r.jsx("div",{className:"text-sm text-gray-500",children:e.code}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:[e.module," • ",e.resourceType," • ",e.action]}),e.description&&r.jsx("div",{className:"text-xs text-gray-600 mt-1",children:e.description})]})]})}),s?.roles.map(t=>{let i=(s.assignments[t.id]||[]).includes(e.id);return r.jsx("td",{className:"px-6 py-4 text-center",children:r.jsx("input",{type:"checkbox",checked:i,onChange:()=>P(t.id,e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})},t.id)})]},e.id))})]})}),0===_.length&&(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("div",{className:"text-6xl mb-4",children:"\uD83D\uDD10"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Permissions Found"}),r.jsx("p",{className:"text-gray-600",children:x||"all"!==u?"Try adjusting your filters":"No permissions available"})]})]}),s&&(0,r.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Total Permissions"}),r.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:s.permissions.length})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Total Roles"}),r.jsx("p",{className:"text-3xl font-bold text-green-600",children:s.roles.length})]})]})]})})}},3767:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>a,default:()=>n});var r=t(8390);let i=(0,r.createProxy)(String.raw`C:\Users\Sam Aluri\Downloads\Hospital Portal\apps\hospital-portal-web\src\app\dashboard\admin\permissions\page.tsx`),{__esModule:a,$$typeof:l}=i,o=i.default,n=o}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[2723,4479,3698,5033,5136,1805,2765],()=>t(8521));module.exports=r})();